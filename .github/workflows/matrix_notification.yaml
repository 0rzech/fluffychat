name: Matrix Notification

on:
  issues:
    types: [ opened ]
  issue_comment:
    types: [ created ]

jobs:
  notify:
    runs-on: ubuntu-latest

    steps:
      - name: Send Matrix Notification
        env:
          MATRIX_URL: https://matrix.org/_matrix/client/v3/rooms/${{ secrets.MATRIX_MANAGEMENT_ROOM }}/send/m.room.message
        run: |
          if [ "${{ github.event.action }}" == "opened" ]; then
            PAYLOAD="{\"msgtype\": \"m.text\", \"body\": \"New Issue Created: ${{ github.event.issue.title }}\\nCreated by: ${{ github.event.issue.user.login }}\\n${{ github.event.issue.body }}\\nURL: ${{ github.event.issue.html_url }}\"}"
          elif [ "${{ github.event.action }}" == "created" ]; then
            PAYLOAD="{\"msgtype\": \"m.text\", \"body\": \"New Comment from ${{ github.event.comment.user.login }}\\n${{ github.event.comment.body }}\\nURL: ${{ github.event.comment.html_url }}\"}"
          fi
          curl -XPOST -H "Authorization: Bearer ${{ secrets.MATRIX_BOT_TOKEN }}" \
               -H "Content-Type: application/json" \
               -d "$PAYLOAD" \
               $MATRIX_URL
